<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Model Viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>polyVerse – Low-Poly Rigged Models</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ---------- Reset ---------- */
    *,*::before,*::after { box-sizing:border-box; margin:0; padding:0 }
    body { font-family:"Inter",sans-serif; line-height:1.6; background:#1e1e20; color:#fff }
    a { text-decoration:none; color:inherit }
    section, footer { opacity:0; animation:fadeInUp 0.6s ease-out forwards }

    /* ---------- Design Tokens & Keyframes ---------- */
    :root {
      --bg:#1e1e20;
      --text:#ffffff;
      --card-bg:#2a2a2d;
      --accent:#ff9800;
      --radius:12px;
    }
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(20px) }
      to   { opacity:1; transform:translateY(0) }
    }
    @keyframes pulse {
      0%,100% { transform:scale(1) }
      50%     { transform:scale(1.05) }
    }

    /* ---------- Buttons ---------- */
    .btn {
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.75rem 1.5rem; border:none; border-radius:var(--radius);
      font-weight:600; cursor:pointer; background:var(--accent);
      color:#fff; transition:transform .2s, box-shadow .2s;
    }
    .btn:hover { transform:scale(1.05); box-shadow:0 6px 14px rgba(0,0,0,.4) }
    .btn:active { transform:scale(.97) }
    .back-btn { margin-bottom:1rem; }

    /* ---------- Buy-Now Button ---------- */
    .buy-btn {
      background:red;
      transition:transform .2s;
      animation:none;
    }
    .buy-btn:hover {
      animation:pulse 0.6s infinite alternate;
      box-shadow:0 6px 14px rgba(0,0,0,.4);
    }

    /* ---------- Navbar ---------- */
    nav {
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:.75rem 1rem; background:var(--card-bg);
      box-shadow:0 1px 3px rgba(0,0,0,.5);
    }
    .logo { display:flex; align-items:center; gap:.5rem }
    nav ul { display:flex; gap:1rem; list-style:none }
    @media(max-width:600px){ nav ul{ display:none } }

    /* ---------- Hero Section (blue gradient) ---------- */
    .hero {
      background:linear-gradient(135deg,#2196F3,#1E88E5);
      padding:4rem 1rem; text-align:center;
    }
    .hero h1 { font-size:2.5rem; margin-bottom:1rem }
    .hero p  { font-size:1.125rem; margin-bottom:2rem; color:rgba(255,255,255,0.85) }

    /* ---------- Search Bar Styling ---------- */
    .hero-search { margin-top:1rem }
    .hero-search input {
      width:100%; max-width:600px;
      padding:1rem 1.5rem;
      border:none; border-radius:var(--radius);
      outline:none; font-size:1rem;
    }
    .hero-search input::placeholder { color:#ccc }

    /* ---------- Gallery ---------- */
    main { max-width:1280px; margin:2rem auto; padding:0 1rem }
    .gallery {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
      gap:1.5rem;
    }
    .card {
      background:var(--card-bg); border-radius:var(--radius);
      overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,.3);
      transition:transform .3s, box-shadow .3s;
      display:flex; flex-direction:column;
      cursor:pointer;
    }
    .card:hover {
      transform:scale(1.05);
      box-shadow:0 8px 24px rgba(255,152,0,0.5);
    }
    .card img { width:100% }
    .card .info { padding:1rem; flex-grow:1; display:flex; flex-direction:column }
    .card h3 { font-size:1rem; margin-bottom:.5rem }
    .card p  { font-size:.875rem; color:#aaa }

    /* ---------- Modals (overlay stays global) ---------- */
    .modal {
      position:fixed; inset:0;
      background:rgba(0,0,0,0.6);   /* semi-transparent dark overlay */
      display:none;
      align-items:center; justify-content:center;
      z-index:1000;
    }
    .modal.active { display:flex }

    .modal-content {
      background:var(--card-bg);
      transform:scale(0.8); opacity:0;
      transition:.3s ease-out;
    }
    .modal.active .modal-content {
      transform:scale(1); opacity:1;
    }

    /* ---------- Model Detail Page ---------- */
    #modelPage {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 2rem 0 2rem 0;
      background: var(--bg);
      min-height: 100vh;
      display: none;
      color: #fff;
    }
    #modelPage .model-detail {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2rem;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }
    @media (min-width: 900px) {
      #modelPage .model-detail {
        flex-direction: row;
        align-items: flex-start;
        gap: 2.5rem;
      }
    }
    #modelPage .model-viewer-container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 2 1 0%;
    }
    #modelPage model-viewer, #modelPage img {
      width: 100%;
      max-width: 1000px;
      height: min(70vh, 600px);
      margin: 0 auto;
      display: block;
      background: var(--card-bg);
      border-radius: var(--radius);
      object-fit: contain;
      box-shadow: 0 4px 24px rgba(0,0,0,0.25);
    }
    #modelPage .desc {
      width: 100%;
      max-width: 500px;
      margin: 2.5rem auto 0 auto;
      padding: 1.5rem 0 0 0;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    #modelPage .desc h2 {
      margin-bottom: 0.5rem;
    }
    #modelPage .desc p {
      line-height: 1.5;
      margin-bottom: 1rem;
    }
    /* Back to Shop button at top */
    #modelPage .back-btn {
      margin-bottom: 2rem;
      margin-top: 0;
      margin-left: 2rem;
      align-self: flex-start;
    }
    @media (max-width: 700px) {
      #modelPage .model-detail {
        flex-direction: column;
        align-items: center;
      }
      #modelPage .desc {
        max-width: 100vw;
        margin-left: 0;
      }
      #modelPage .back-btn {
        margin-left: 1rem;
      }
    }
    /* --- Suggested/Related Models Sidebar --- */
    #modelPage .suggested {
      flex: 1 1 0%;
      min-width: 220px;
      max-width: 320px;
      margin-left: 2rem;
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 1.25rem 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      overflow-y: auto;
      max-height: 600px;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    #modelPage .suggested h4 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }
    #modelPage .suggested .suggested-card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #232326;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: background 0.15s;
    }
    #modelPage .suggested .suggested-card:hover {
      background: #28282b;
    }
    #modelPage .suggested .suggested-thumb {
      width: 48px;
      height: 48px;
      border-radius: 6px;
      object-fit: cover;
      background: #18181a;
    }
    #modelPage .suggested .suggested-title {
      font-size: 0.98rem;
      color: #fff;
      font-weight: 500;
    }
    @media (max-width: 600px) {
      #modelPage .suggested {
        display: none;
      }
    }

    /* ---------- Model Viewer Styling ---------- */
    model-viewer {
      width:100%;
      height:400px;
      border-radius:var(--radius);
      background:var(--card-bg);
      --poster-color: transparent;
    }

    .model-viewer-container {
      position:relative;
      border-radius:var(--radius);
      overflow:hidden;
    }

    .view-toggle {
      position:absolute;
      top:10px;
      right:10px;
      background:rgba(0,0,0,0.7);
      color:white;
      border:none;
      padding:8px 12px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
      z-index:10;
    }

    .view-toggle:hover {
      background:rgba(0,0,0,0.9);
    }

    /* ---------- Checkout Page ---------- */
    #checkoutPage {
      display:none; padding:2rem; min-height:100vh;
      background:var(--bg); color:var(--text);
    }
    #checkoutPage form {
      max-width:500px; margin:auto; display:flex; flex-direction:column; gap:1rem;
    }
    #checkoutPage label { display:flex; flex-direction:column; font-weight:600 }
    #checkoutPage input {
      padding:.75rem 1rem; border:none; border-radius:var(--radius);
      background:var(--card-bg); color:#fff; outline:none;
    }

    /* ---------- Contact Footer ---------- */
    footer {
      padding:2rem 1rem; text-align:center; background:#111;
      margin-top:2rem;
    }
    footer p { margin:.5rem 0 }

    /* ---------- Redesigned Login / Register Modal ---------- */
    #loginModal .modal-content {
      position:relative;
      width:100%; max-width:380px;
      padding:2rem 2rem 2.5rem;
      border-radius:var(--radius);
      background:var(--card-bg);
      box-shadow:0 8px 24px rgba(0,0,0,0.4);
    }
    #loginModal .modal-header {
      position:relative;
      display:flex; justify-content:center; align-items:center;
      margin-bottom:1.5rem;
    }
    #loginModal .modal-header h2 {
      font-size:2rem; font-weight:600; color:var(--text);
    }
    #loginModal .modal-header .close {
      position:absolute; top:-0.5rem; right:-0.5rem;
      width:32px; height:32px;
      border:none; border-radius:50%;
      background:transparent;
      color:var(--text); font-size:1.5rem; line-height:1;
      cursor:pointer;
      transition:background .2s;
    }
    #loginModal .modal-header .close:hover {
      background:rgba(255,255,255,0.08);
    }

    #loginModal label {
      width:100%; display:block; font-size:.85rem; font-weight:600;
      margin-bottom:.25rem; color:#ccc;
    }
    #loginModal input.login-input {
      width:100%;
      padding:.75rem 1rem;
      border:none; border-radius:var(--radius);
      background:#202024;
      color:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      margin-bottom:1.25rem;
      outline:none;
    }
    #loginModal input.login-input::placeholder { color:#888 }

    /* row that holds Continue + Create Account */
    #loginModal .action-row{
      display:flex; gap:1rem; margin-bottom:1rem;
    }
    #loginModal .action-row .btn{
      flex:1; justify-content:center;
    }

    #loginModal .login-btn,
    #loginModal .register-submit{
      width:100%;
      display:block;
      padding:.75rem 1rem;
      border:none; border-radius:var(--radius);
      background:var(--accent);
      color:#fff; font-weight:600; text-align:center;
      cursor:pointer;
      transition:background-color .2s,transform .2s;
    }
    #loginModal .login-btn:hover,
    #loginModal .register-submit:hover {
      background:#ffb74d;
      transform:translateY(-1px);
    }

    .google-btn {
      width:100%; display:block;
      margin-top:1rem;
      padding:.75rem 1rem;
      border:none; border-radius:var(--radius);
      background:#fff; color:#444; font-weight:600; text-align:center;
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,0.25);
      transition:background-color .2s,transform .2s;
    }
    .google-btn:hover {
      background:#f1f1f1;
      transform:translateY(-1px);
    }

    #loginModal p {
      margin-top:1.25rem;
      font-size:.825rem;
      color:#999;
      text-align:center;
    }

    /* hide register view by default */
    #registerView{ display:none; }

    /* --- Navbar Search Bar --- */
    .navbar-search-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      display: none; /* hidden by default */
    }
    .navbar-search {
      width: 100%;
      max-width: 300px;
      min-width: 120px;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      background: #232326;
      color: #fff;
      margin: 0 auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      outline: none;
      transition: box-shadow .2s;
      text-align: center;
    }
    .navbar-search::placeholder {
      color: #aaa;
    }
    @media (max-width: 600px) {
      .navbar-search {
        max-width: 80vw;
      }
    }
    /* --- Hide hero search on model page --- */
    .hero-search.hide { display: none !important; }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav id="navbar">
    <div class="logo">
     <img src="https://img.itch.zone/aW1hZ2UvMzY2NTA1MS8yMTgwOTEzNC5wbmc=/250x600/Q5BHfP.png"
     alt="  polyVerse logo"
     

           alt="polyVerse logo" style="height:32px;width:32px;border-radius:6px">
      <span style="font-weight:600;font-size:1.1rem">polyVerse</span>
    </div>
    <div class="navbar-search-container" id="navbarSearchContainer">
      <input id="navbarSearch" type="search" placeholder="Search for anything" class="navbar-search">
    </div>
    <ul>
      <li><button class="btn" id="loginBtn">Log In</button></li>
    </ul>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <h1>Any low-poly character you could ever need</h1>
    <p>Build something beautiful with 10+ free models</p>
    <div class="hero-search">
      <input id="heroSearch" type="search" placeholder="Search for anything">
    </div>
  </section>

  <!-- GALLERY -->
  <main id="mainContent">
    <section class="gallery" id="gallery"></section>
  </main>

  <!-- MODEL DETAIL PAGE -->
  <section id="modelPage">
    <button class="btn back-btn" id="backModel">← Back to Shop</button>
    <div class="model-detail">
      <div class="model-viewer-container">
        <button class="view-toggle" id="viewToggle">3D View</button>
        <img id="modelImg" src="" alt="Model preview">
        <model-viewer 
          id="modelViewer"
          camera-controls 
          auto-rotate 
          shadow-intensity="1"
          environment-image="neutral"
          exposure="0.5"
          shadow-softness="0.5"
          style="display:none;">
        </model-viewer>
        <div class="desc">
          <h2 id="modelTitle"></h2>
          <p id="modelDesc"></p>
          <button class="btn buy-btn" id="buyNowBtn">Buy Now</button>
        </div>
      </div>
      <aside class="suggested" id="suggestedModels">
        <h4>Suggested Models</h4>
        <!-- Suggested models will be rendered here -->
      </aside>
    </div>
  </section>

  <!-- CHECKOUT PAGE -->
  <section id="checkoutPage">
    <button class="btn back-btn" id="backCheckout">← Back</button>
    <h2 style="text-align:center;margin-bottom:1rem;">Checkout</h2>
    <form id="checkoutForm">
      <label>
        Full Name
        <input type="text" required placeholder="Your Name">
      </label>
      <label>
        Email Address
        <input type="email" required placeholder="you@example.com">
      </label>
      <label>
        Billing Address
        <input type="text" required placeholder="Street, City, Country">
      </label>
      <button type="submit" class="btn" style="justify-content:center;">Pay with PayPal</button>
    </form>
  </section>

  <!-- CONTACT INFO FOOTER -->
  <footer>
    <h3>Contact Us</h3>
    <p>Email: korenbarshalom@gmail.com</p>
    <p>Phone: 052-221-5113</p>
  </footer>

  <!-- LOGIN / REGISTER MODAL -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Log In</h2>
        <button class="close" data-close>&times;</button>
      </div>

      <!-- ===== LOGIN VIEW ===== -->
      <div id="loginView">
        <label>Email</label>
        <input type="email" class="login-input" placeholder="you@example.com" required>

        <label>Password</label>
        <input type="password" class="login-input" placeholder="Your password" required>

        <div class="action-row">
          <button class="login-btn">Continue</button>
          <button class="btn" id="createAccountBtn">Create&nbsp;Account</button>
        </div>

        <button class="google-btn">Log in with Google</button>
        <p>Auth backend coming soon.</p>
      </div>

      <!-- ===== REGISTER VIEW ===== -->
      <div id="registerView">
        <label>Full Name</label>
        <input type="text" class="login-input" placeholder="Your Name" required>

        <label>Email</label>
        <input type="email" class="login-input" placeholder="you@example.com" required>

        <label>Password</label>
        <input type="password" class="login-input" placeholder="Choose a strong password" required>

        <button class="register-submit">Create Account</button>

        <button class="google-btn">Sign up with Google</button>
        <p style="margin-top:.75rem;">Already have an account? <a href="#" id="backToLogin" style="color:var(--accent);">Log In</a></p>
      </div>
    </div>
  </div>

  <script type="module">
    // === DATA & HOOKS ===
    const models = [
      { 
        id:1, 
        title:'Human Character Base', 
        price:0, 
        thumb:'https://img.itch.zone/aW1hZ2UvMzYzMDcyMC8yMTYwNTk3NS5wbmc=/347x500/0EGaXE.png', 
        desc:'A versatile low-poly human base mesh, ready for your animations and rigs.',
        src: '3DHuman4.gltf'  // Your existing .gltf file
      },
      { 
        id:2, 
        title:'Human Character Base', 
        price:0, 
        thumb:'https://img.itch.zone/aW1hZ2UvMzYyNjQzMS8yMTgxNjg3OS5wbmc=/347x500/tvf3ho.png', 
        desc:'Alternate low-poly human model optimized for mobile and VR.',
        src: '3DHuman11.gltf'
      },
      { 
        id:3, 
        title:'Player Model', 
        price:0, 
        thumb:'https://img.itch.zone/aW1hZ2UvMzYyNjI1OC8yMTYwMzg1Mi5wbmc=/347x500/Qsh9nF.png', 
        desc:'A stylized player avatar with simple topology for game characters.',
        src: '3DPlayer2.gltf'
      },
      { 
        id:4, 
        title:'Knight', 
        price:0, 
        thumb:'https://placehold.co/400x400?text=Knight', 
        desc:'A medieval knight in low-poly style.',
        src: 'knight.glb'
      },
      { 
        id:5, 
        title:'Archer', 
        price:0, 
        thumb:'https://placehold.co/400x400?text=Archer', 
        desc:'A ready-to-animate archer character.',
        src: 'archer.glb'
      },
      { 
        id:6, 
        title:'Steampunk Bot', 
        price:0, 
        thumb:'https://placehold.co/400x400?text=Bot', 
        desc:'Low-poly steampunk robot NPC.',
        src: 'robot.glb'
      },
      { 
        id:7, 
        title:'Voxel Mage', 
        price:0, 
        thumb:'https://placehold.co/400x400?text=Mage', 
        desc:'Blocky mage perfect for voxel games.',
        src: 'mage.glb'
      },
      { 
        id:8, 
        title:'Sci-Fi Soldier', 
        price:0, 
        thumb:'https://placehold.co/400x400?text=Soldier', 
        desc:'Futuristic soldier rigged for animation.',
        src: 'soldier.glb'
      },
    ];

    // DOM refs
    const gallery      = document.getElementById('gallery');
    const heroSearch   = document.getElementById('heroSearch');
    const loginBtn     = document.getElementById('loginBtn');
    const loginModal   = document.getElementById('loginModal');
    const modelPage    = document.getElementById('modelPage');
    const modelImg     = document.getElementById('modelImg');
    const modelTitle   = document.getElementById('modelTitle');
    const modelDesc    = document.getElementById('modelDesc');
    const modelViewer  = document.getElementById('modelViewer');
    const viewToggle   = document.getElementById('viewToggle');
    const backModel    = document.getElementById('backModel');
    const buyNowBtn    = document.getElementById('buyNowBtn');
    const mainContent  = document.getElementById('mainContent');
    const checkoutPage = document.getElementById('checkoutPage');
    const backCheckout = document.getElementById('backCheckout');

    // NEW refs for login/register toggle
    const loginView   = document.getElementById('loginView');
    const registerView= document.getElementById('registerView');
    const modalTitle  = document.getElementById('modalTitle');
    const createAccBtn= document.getElementById('createAccountBtn');
    const backToLogin = document.getElementById('backToLogin');

    const navbarSearchContainer = document.getElementById('navbarSearchContainer');
    const navbarSearch = document.getElementById('navbarSearch');
    const suggestedModels = document.getElementById('suggestedModels');

    const heroBanner = document.querySelector('.hero');

    // Track last opened model for context-aware back
    let lastOpenedModel = null;

    // --- Gallery ---
    function renderGallery(list){
      gallery.innerHTML='';
      list.forEach(m=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`
          <img src="${m.thumb}" alt="${m.title}">
          <div class="info">
            <h3>${m.title}</h3>
            <p>${m.price?`$${m.price.toFixed(2)}`:'Free'}</p>
          </div>`;
        card.onclick=()=>openModelPage(m);
        gallery.appendChild(card);
      });
    }
    renderGallery(models);

    // --- Search Bar Logic ---
    function doSearch(q) {
      const query = q.toLowerCase();
      renderGallery(models.filter(m =>
        m.title.toLowerCase().includes(query) ||
        (m.desc && m.desc.toLowerCase().includes(query))
      ));
    }
    heroSearch.addEventListener('input', e => {
      doSearch(e.target.value);
      // Keep navbar search in sync if visible
      if (navbarSearchContainer.style.display === 'flex') {
        navbarSearch.value = e.target.value;
      }
      // Smart reset: if cleared, return to Home Page and show all models
      if (e.target.value.trim() === '') {
        modelPage.style.display = 'none';
        checkoutPage.style.display = 'none';
        mainContent.style.display = 'block';
        heroSearch.parentElement.classList.remove('hide');
        navbarSearchContainer.style.display = 'none';
        if(heroBanner) heroBanner.style.display = '';
        renderGallery(models);
      }
    });
    navbarSearch.addEventListener('input', e => {
      doSearch(e.target.value);
      // Keep hero search in sync if visible
      if (!heroSearch.parentElement.classList.contains('hide')) {
        heroSearch.value = e.target.value;
      }
      // Smart reset: if cleared, return to Home Page and show all models
      if (e.target.value.trim() === '') {
        modelPage.style.display = 'none';
        checkoutPage.style.display = 'none';
        mainContent.style.display = 'block';
        heroSearch.parentElement.classList.remove('hide');
        navbarSearchContainer.style.display = 'none';
        if(heroBanner) heroBanner.style.display = '';
        renderGallery(models);
      }
    });
    navbarSearch.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        // Always show gallery and hide model/checkout pages on Enter
        modelPage.style.display = 'none';
        checkoutPage.style.display = 'none';
        mainContent.style.display = 'block';
        heroSearch.parentElement.classList.remove('hide');
        navbarSearchContainer.style.display = 'flex';
        doSearch(navbarSearch.value);
        window.scrollTo(0,0);
      }
    });

    // --- Model detail & checkout navigation ---
    function openModelPage(m){
      // Hide hero search, show navbar search
      heroSearch.parentElement.classList.add('hide');
      navbarSearchContainer.style.display = 'flex';
      navbarSearch.value = '';
      // Hide main content, show model page
      mainContent.style.display = 'none';
      checkoutPage.style.display = 'none';
      modelPage.style.display = 'block';
      // Hide hero banner
      if(heroBanner) heroBanner.style.display = 'none';
      // Set model details
      modelImg.src = m.thumb;
      modelTitle.textContent = m.title;
      modelDesc.textContent = m.desc;
      if (m.src) {
        modelViewer.src = m.src;
      }
      // Show 3D model by default, hide image and toggle
      modelImg.style.display = 'none';
      modelViewer.style.display = 'block';
      viewToggle.style.display = 'none';
      window.scrollTo(0,0);
      // Render suggested models (exclude current)
      renderSuggestedModels(m.id);
      // Remember last opened model for checkout back
      lastOpenedModel = m;
    }

    // --- Suggested Models Logic ---
    function renderSuggestedModels(currentId) {
      if (!suggestedModels) return;
      suggestedModels.innerHTML = '<h4>Suggested Models</h4>';
      const others = models.filter(mod => mod.id !== currentId).slice(0, 5);
      others.forEach(mod => {
        const card = document.createElement('div');
        card.className = 'suggested-card';
        card.innerHTML = `
          <img class="suggested-thumb" src="${mod.thumb}" alt="${mod.title}">
          <span class="suggested-title">${mod.title}</span>
        `;
        card.onclick = () => openModelPage(mod);
        suggestedModels.appendChild(card);
      });
    }

    // Toggle between image and 3D view
    viewToggle.addEventListener('click', () => {
      if (modelImg.style.display === 'none') {
        // Switch to image view
        modelImg.style.display = 'block';
        modelViewer.style.display = 'none';
        viewToggle.textContent = '3D View';
      } else {
        // Switch to 3D view
        modelImg.style.display = 'none';
        modelViewer.style.display = 'block';
        viewToggle.textContent = 'Image View';
      }
    });
    
    backModel.onclick=()=>{
      modelPage.style.display='none';
      mainContent.style.display='block';
      // Hide navbar search, show hero search
      navbarSearchContainer.style.display = 'none';
      heroSearch.parentElement.classList.remove('hide');
      // Show hero banner
      if(heroBanner) heroBanner.style.display = '';
      window.scrollTo(0,0);
    };
    buyNowBtn.onclick=()=>{
      modelPage.style.display='none';
      mainContent.style.display='none';
      checkoutPage.style.display='block';
      // Show navbar search, hide hero search and hero banner
      navbarSearchContainer.style.display = 'flex';
      heroSearch.parentElement.classList.add('hide');
      if(heroBanner) heroBanner.style.display = 'none';
      window.scrollTo(0,0);
    };
    backCheckout.onclick=()=>{
      // Return to previous model page if available
      if (lastOpenedModel) {
        checkoutPage.style.display = 'none';
        openModelPage(lastOpenedModel);
      } else {
        // Fallback: go to home/shop
        checkoutPage.style.display = 'none';
        modelPage.style.display = 'none';
        mainContent.style.display = 'block';
        navbarSearchContainer.style.display = 'none';
        heroSearch.parentElement.classList.remove('hide');
        if(heroBanner) heroBanner.style.display = '';
        window.scrollTo(0,0);
      }
    };

    // --- Login / Register modal logic ---
    function openModal(m){ 
      m.classList.add('active'); 
      showLogin();               // always default to login view
    }
    function closeModal(m){ m.classList.remove('active'); }
    document.querySelectorAll('[data-close]').forEach(btn=>{
      btn.onclick=()=>closeModal(btn.closest('.modal'));
    });
    loginBtn.onclick=()=>openModal(loginModal);
    window.addEventListener('keydown',e=>{
      if(e.key==='Escape') document.querySelectorAll('.modal.active').forEach(closeModal);
    });

    // toggle helpers
    function showLogin(){
      loginView.style.display='block';
      registerView.style.display='none';
      modalTitle.textContent='Log In';
    }
    function showRegister(){
      loginView.style.display='none';
      registerView.style.display='block';
      modalTitle.textContent='Create Account';
    }
    createAccBtn.onclick=showRegister;
    backToLogin.onclick=e=>{
      e.preventDefault();
      showLogin();
    };

    // --- Fake checkout ---
    document.getElementById('checkoutForm').addEventListener('submit',e=>{
      e.preventDefault();
      alert('Redirecting to PayPal…');
      // implement real PayPal redirect here
    });

    // --- On page load, ensure modelPage is hidden to prevent flash ---
    window.addEventListener('DOMContentLoaded', () => {
      modelPage.style.display = 'none';
      navbarSearchContainer.style.display = 'none';
      heroSearch.parentElement.classList.remove('hide');
      // Show hero banner
      if(heroBanner) heroBanner.style.display = '';
    });
  </script>
</body>
</html>
